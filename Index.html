<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>í”Œë¼í•„í„° ì±Œë¦°ì§€ â€” í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ë°ëª¨</title>
<style>
  :root{
    --bg1:#071124; --bg2:#0b3b2e;
    --accent:#ffd700; --primary:#e63946; --secondary:#2ec4b6;
    --glass: rgba(255,255,255,0.04);
    --card-bg: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    --max-width:1200px;
  }
  /* reset */
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    font-family: "Noto Sans KR", Apple SD Gothic Neo, "Segoe UI", Roboto, sans-serif;
    background:
      radial-gradient(1000px 480px at 10% 10%, rgba(8,48,74,0.35) 0%, transparent 18%),
      linear-gradient(180deg,var(--bg1) 0%, var(--bg2) 60%);
    color:#fff; -webkit-font-smoothing:antialiased; overflow:hidden;
  }

  /* Full-screen app */
  #app{
    min-height:100vh; width:100vw; display:flex; flex-direction:column;
  }
  header{
    display:flex; align-items:center; justify-content:space-between;
    padding:18px 24px; gap:12px; backdrop-filter: blur(6px);
    background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  }
  .logo{display:flex;align-items:center;gap:12px}
  .logo .icon{
    width:44px;height:44px;border-radius:10px;
    display:grid;place-items:center;color:#4a2b00;
    background:linear-gradient(135deg,var(--accent),#ffec99); font-weight:800;
    box-shadow:0 6px 18px rgba(0,0,0,0.45);
  }
  h1{font-size:18px;letter-spacing:0.6px}
  .lead{font-size:12px;color:#d9f7f0;opacity:0.95;margin-top:2px}

  main{display:flex;flex:1;gap:20px;padding:24px;align-items:stretch}
  /* Left: scene / demo */
  .scene{flex:1;min-width:360px;border-radius:16px;padding:20px;position:relative;
    background:var(--card-bg);box-shadow: 0 14px 34px rgba(0,0,0,0.6);overflow:auto;}
  .scene h2{font-size:16px;margin-bottom:8px}
  .scene .sub{font-size:13px;color:#cfeee8;margin-bottom:12px}

  /* Right: controls / info */
  .controls{width:420px;max-width:42%;min-width:300px;display:flex;flex-direction:column;gap:14px;}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:12px;padding:12px;box-shadow: inset 0 1px 0 rgba(255,255,255,0.02);}
  label{font-size:13px;display:block;margin-bottom:6px;color:#dfeff0}
  input[type=range]{width:100%}
  .row{display:flex;gap:8px;align-items:center}
  .btn{display:inline-flex;gap:8px;align-items:center;justify-content:center;padding:10px 12px;
    border-radius:10px;background:linear-gradient(180deg,var(--primary),#b91c2b);color:white;border:none;cursor:pointer;font-weight:600}
  .btn.secondary{background:linear-gradient(180deg,var(--secondary),#1aa89a);color:#003;box-shadow:none}

  footer{padding:10px 24px;border-top:1px solid rgba(255,255,255,0.02);display:flex;justify-content:space-between;font-size:12px;color:#cfeee8}

  /* Snow & Xmas decoration (visual only) */
  .snow-layer{position:absolute;left:0;right:0;top:0;bottom:0;pointer-events:none}
  .snow{position:absolute;width:100%;height:100%;background-image:radial-gradient(circle at 6px 6px, rgba(255,255,255,0.9) 1px, transparent 4px);opacity:0.6;mix-blend-mode:screen;animation:fall 14s linear infinite}
  .snow.fast{animation-duration:7s;opacity:0.95}
  @keyframes fall{0%{transform:translateY(-10vh)}100%{transform:translateY(100vh)}}

  .tree-side{position:absolute;right:24px;bottom:12px;width:240px;max-width:30vw;pointer-events:none;opacity:0.95}
  .badge{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:999px;background:rgba(0,0,0,0.12);font-weight:700}

  /* content pieces */
  .intro, .howto, .experiment, .calculator {margin-bottom:14px}
  .materials{display:flex;flex-wrap:wrap;gap:8px}
  .mat{background:rgba(255,255,255,0.03);padding:8px;border-radius:8px;font-size:13px}

  /* form & table */
  .tbl{width:100%;border-collapse:collapse;font-size:13px;margin-top:8px}
  .tbl th, .tbl td{padding:8px;border-bottom:1px dashed rgba(255,255,255,0.04);text-align:left}
  .small{font-size:12px;color:#cfeee8}

  /* canvas chart */
  #chart{width:100%;height:160px;background:linear-gradient(180deg, rgba(0,0,0,0.05), transparent);border-radius:8px}

  /* responsive */
  @media (max-width:1000px){
    main{flex-direction:column;padding:16px}
    .controls{width:100%;max-width:unset}
    .tree-side{display:none}
  }
</style>
</head>
<body>
<div id="app" role="application" aria-label="í”Œë¼í•„í„° ì±Œë¦°ì§€ ë°ëª¨">
  <header>
    <div class="logo">
      <div class="icon">â˜…</div>
      <div>
        <h1>í”Œë¼í•„í„° ì±Œë¦°ì§€</h1>
        <div class="lead">ì„¸íƒê¸° ë¯¸ì„¸í”Œë¼ìŠ¤í‹± ì €ê° â€” DIY í•„í„° ì‹¤í—˜ & ì‚¬ì—…í™” ë°ëª¨</div>
      </div>
    </div>
    <div style="display:flex;gap:10px;align-items:center">
      <div class="badge">í•™êµ í”„ë¡œì íŠ¸ â€¢ ì‹¤í—˜ Â· ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸</div>
      <button id="help" class="btn secondary" aria-label="ë„ì›€ë§">ë„ì›€ë§</button>
    </div>
  </header>

  <main>
    <!-- LEFT: Scene + content -->
    <section class="scene" aria-labelledby="title">
      <h2 id="title">ë¬¸ì œ: ì„¸íƒìœ¼ë¡œ ë°œìƒí•˜ëŠ” ë¯¸ì„¸í”Œë¼ìŠ¤í‹±</h2>
      <div class="sub">í•©ì„±ì„¬ìœ  ì„¸íƒì‹œ ë°œìƒí•˜ëŠ” ì„¬ìœ  ë§ˆì´í¬ë¡œí”Œë¼ìŠ¤í‹±ì´ í•˜ìˆ˜ë¡œ ìœ ì…ë˜ì–´ í™˜ê²½ì— ì¶•ì ë©ë‹ˆë‹¤. í”Œë¼í•„í„°ëŠ” í•™ìƒ ìˆ˜ì¤€ì—ì„œ ë§Œë“¤ ìˆ˜ ìˆëŠ” ì €ë¹„ìš© ì„¸íƒ í•„í„° í‚¤íŠ¸ì…ë‹ˆë‹¤.</div>

      <div class="intro card">
        <strong>í•œëˆˆì— ë³´ê¸°</strong>
        <p class="small" style="margin-top:8px">
          í”Œë¼ìŠ¤í‹± ë¯¸ì„¸ì„¬ìœ ëŠ” 0.3mm ì´í•˜ê¹Œì§€ ë¶„í•´ë˜ì–´ ìˆ˜ê³„ì— ì¶•ì ë©ë‹ˆë‹¤. ì´ ë°ëª¨ëŠ” <em>ì‹¤í—˜ ì„¤ê³„ â†’ í•„í„° ì œì‘ â†’ ìˆ˜ê±°ëŸ‰ ì¸¡ì • â†’ ê²½ì œì„± ê²€í† </em>ê¹Œì§€ ë³´ì—¬ì¤ë‹ˆë‹¤.
        </p>
      </div>

      <div class="howto card">
        <strong>ì–´ë–»ê²Œ ì‘ë™í•˜ë‚˜?</strong>
        <ol style="margin-top:8px;padding-left:18px;font-size:13px;line-height:1.5;color:#e8fdf6">
          <li>ì„¸íƒê¸° ë°°ìˆ˜êµ¬ì— ì¼ì°¨ ê±°ë¦„ë§(ë©”ì‰¬) ì„¤ì¹˜</li>
          <li>ì„¸íƒ í›„ ë°°ì¶œë˜ëŠ” ë¬¼ì€ í•„í„°ë¥¼ í†µê³¼í•˜ë©° ì„¬ìœ  ì¡°ê°ì´ ê±¸ë¦¼</li>
          <li>í•„í„°ëŠ” ì£¼ê¸°ì  ìˆ˜ê±°Â·ê±´ì¡° í›„ ë¬´ê²Œë¥¼ ì¸¡ì •í•´ í¬ì§‘ëŸ‰ ì‚°ì •</li>
        </ol>
        <div style="margin-top:10px" class="small">ì•± ìš°ì¸¡ì—ì„œ <strong>ì‹¤í—˜ ë°ì´í„° ì…ë ¥ â†’ ê³„ì‚° â†’ ê·¸ë˜í”„</strong>ë¡œ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.</div>
      </div>

      <div class="card experiment" id="experimentCard">
        <strong>ì‹¤í—˜ ê³„íš(í•™êµ ë ˆë²¨)</strong>
        <div style="margin-top:8px" class="small">
          <ul style="padding-left:18px;line-height:1.5">
            <li>ëŒ€ìƒ: ë™ì¼ ì½”ìŠ¤ ì„¸íƒ(ë©´ 3kg, í•©ì„± 3kg ë‚˜ë‰˜ì–´ ìˆ˜í–‰)</li>
            <li>ì¡°ê±´: í‘œì¤€ ì„¸íƒëª¨ë“œ, ì„¸ì œ ë™ì¼, 3íšŒ ë°˜ë³µ</li>
            <li>ì¸¡ì •: í•„í„° ì „í›„ ë¬´ê²Œ(ê±´ì¡° ê¸°ì¤€), í¬ì§‘ëŸ‰ = (í›„ - ì „) g</li>
          </ul>
        </div>

        <div style="margin-top:10px">
          <label for="teamName">íŒ€/í•™êµ ì´ë¦„</label>
          <input id="teamName" type="text" placeholder="ì˜ˆ: OOê³ ë“±í•™êµ í”Œë¼í•„í„°íŒ€" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff">
          <table class="tbl" aria-describedby="experiment-desc">
            <thead><tr><th>ì‹¤í—˜ë²ˆí˜¸</th><th>ì„¸íƒë¬¼(ì¢…ë¥˜)</th><th>í•„í„° ì „(g)</th><th>í•„í„° í›„(g)</th><th>í¬ì§‘(g)</th></tr></thead>
            <tbody id="dataRows">
              <!-- rows populated by JS -->
            </tbody>
          </table>

          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="addRow" class="btn">í–‰ ì¶”ê°€</button>
            <button id="exportCSV" class="btn secondary">CSV ë‚´ë³´ë‚´ê¸°</button>
          </div>
        </div>
      </div>

      <div class="card calculator">
        <strong>ì˜ˆìƒ í¬ì§‘ëŸ‰ ê³„ì‚°ê¸°</strong>
        <div style="margin-top:8px" class="small">
          <label>1íšŒ ì„¸íƒë‹¹ ì˜ˆìƒ ì„¬ìœ  ë¶„ì¶œëŸ‰ (g)</label>
          <input id="perWash" type="number" min="0" step="0.01" value="0.5" style="width:120px;padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff">
          <div style="height:8px"></div>
          <label>í•„í„° íš¨ìœ¨ (%)</label>
          <input id="eff" type="number" min="0" max="100" value="85" style="width:120px;padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff">
          <div style="height:8px"></div>
          <label>ì›” ì„¸íƒ íšŸìˆ˜ (ê°€ì •/í•™êµ)</label>
          <input id="washes" type="number" min="0" value="30" style="width:120px;padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff">
          <div style="margin-top:10px;display:flex;gap:8px">
            <button id="calcBtn" class="btn">ê³„ì‚°</button>
            <button id="resetCalc" class="btn secondary">ì´ˆê¸°í™”</button>
          </div>
          <div id="calcResult" style="margin-top:10px;font-weight:700"></div>
        </div>
      </div>

      <div class="card">
        <strong>ë¹„ì¦ˆë‹ˆìŠ¤Â·í™•ì¥ ì•„ì´ë””ì–´</strong>
        <ol style="margin-top:8px;padding-left:18px;font-size:13px;line-height:1.4;color:#e8fdf6">
          <li>í•™êµìš© í‚¤íŠ¸(ë©”ì‰¬+ì¼€ì´ìŠ¤+ìˆ˜ê±°ë°±) ì œì‘Â·íŒë§¤</li>
          <li>ìˆ˜ê±° ë°ì´í„° ê¸°ë°˜ 'í”Œë¼ìŠ¤í‹± í¬ì§‘ ì¸ì¦' ë°œê¸‰(ì§€ì—­ ê¸°ì—… í˜‘ì—…)</li>
          <li>ìˆ˜ê±°ëœ ì„¬ìœ ë¥¼ ì˜ˆìˆ Â·ë¦¬ì‚¬ì´í´ ì›ë£Œë¡œ ì „í™˜</li>
        </ol>
      </div>

      <canvas id="chart" aria-label="ì‹¤í—˜ ê²°ê³¼ ì°¨íŠ¸"></canvas>

    </section>

    <!-- RIGHT: controls -->
    <aside class="controls" aria-label="controls">
      <div class="card">
        <label>ëˆˆ ê°•ë„ (ë°ì½”)</label>
        <input id="snowRange" type="range" min="0" max="100" value="60" aria-label="ëˆˆ ê°•ë„">
        <div class="small" style="margin-top:6px">ì‹œê°ì  íš¨ê³¼ì…ë‹ˆë‹¤. ì‹¤í—˜ì— ì˜í–¥ ì—†ìŒ.</div>
      </div>

      <div class="card">
        <label>í•„í„° í…œí”Œë¦¿</label>
        <div style="display:flex;gap:8px;align-items:center">
          <button id="downloadSVG" class="btn">í…œí”Œë¦¿ ë‚´ë ¤ë°›ê¸°</button>
          <button id="printSVG" class="btn secondary">ì¸ì‡„</button>
        </div>
        <div class="small" style="margin-top:8px">3Dí”„ë¦°í„° ì¼€ì´ìŠ¤ ì¹˜ìˆ˜ ë˜ëŠ” ê°„ë‹¨í•œ ë©”ì‰¬ íŒ¨í„´(ì¸ì‡„ìš© SVG)</div>
      </div>

      <div class="card">
        <label>ì‹¤í—˜ ë°ì´í„° ì˜ˆì‹œ ë¶ˆëŸ¬ì˜¤ê¸°</label>
        <div style="display:flex;gap:8px">
          <button id="loadDemo" class="btn">ë°ëª¨ ë¶ˆëŸ¬ì˜¤ê¸°</button>
          <button id="clearData" class="btn secondary">ë°ì´í„° ì´ˆê¸°í™”</button>
        </div>
      </div>

      <div class="card">
        <label>ê°„ë‹¨í•œ ì£¼ë¬¸ì„œ(ì‹œì—°ìš©)</label>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input id="orderQty" type="number" min="1" value="10" style="width:120px;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff">
          <button id="generateQuote" class="btn">ê²¬ì  ìƒì„±</button>
        </div>
        <div id="quote" class="small" style="margin-top:8px"></div>
      </div>

      <div class="card">
        <strong>ë°œí‘œ íŒ</strong>
        <ul style="padding-left:18px;margin-top:8px" class="small">
          <li>ì‹¤í—˜ ì „Â·í›„ ì‚¬ì§„ì„ ë‚¨ê¸°ê³  ë¬´ê²ŒëŠ” ê±´ì¡° ê¸°ì¤€ìœ¼ë¡œ ì¸¡ì •</li>
          <li>ë°˜ë³µ(ìµœì†Œ 3íšŒ)í•œ í‰ê· ê°’ì„ ì‚¬ìš©</li>
          <li>ë¹„ìš©Â·íš¨ìœ¨(í¬ì§‘ g ë‹¹ ë¹„ìš©) ê³„ì‚°í•´ì„œ ì„¤ë“ ìë£Œë¡œ ì œì‹œ</li>
        </ul>
      </div>

    </aside>
  </main>

  <footer>
    <div>í”Œë¼í•„í„° ì±Œë¦°ì§€ â€” í–„ì˜ í•™êµ í”„ë¡œì íŠ¸ ë°ëª¨</div>
    <div>ğŸ„ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì—ë””ì…˜</div>
  </footer>

  <!-- decorative tree & snow -->
  <div class="snow-layer" aria-hidden="true">
    <div class="snow"></div>
    <div class="snow fast" style="opacity:0.7"></div>
  </div>
  <svg class="tree-side" viewBox="0 0 200 300" aria-hidden="true">
    <defs>
      <linearGradient id="tg" x1="0" x2="0" y1="0" y2="1">
        <stop offset="0" stop-color="#2ecc71"/><stop offset="1" stop-color="#0b6623"/>
      </linearGradient>
    </defs>
    <polygon points="100,8 140,80 60,80" fill="url(#tg)"/>
    <polygon points="100,60 160,140 40,140" fill="url(#tg)"/>
    <polygon points="100,120 180,220 20,220" fill="url(#tg)"/>
    <rect x="84" y="220" width="32" height="46" rx="4" fill="#6b3e13"/>
  </svg>

</div>

<script>
/*
  í”Œë¼í•„í„° ì±Œë¦°ì§€ ë°ëª¨ ìŠ¤í¬ë¦½íŠ¸
  - ë°ì´í„° í…Œì´ë¸” ê´€ë¦¬ (ì¶”ê°€/ì‚­ì œ/CSV ë‚´ë³´ë‚´ê¸°)
  - ê³„ì‚°ê¸°: ì˜ˆìƒ í¬ì§‘ëŸ‰ ê³„ì‚°
  - ê°„ë‹¨ ì°¨íŠ¸(ìº”ë²„ìŠ¤)ë¡œ ê° í–‰ì˜ í¬ì§‘ëŸ‰ í‘œì‹œ
  - SVG í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ/ì¸ì‡„
  - ë°ëª¨ ë°ì´í„° ë¡œë“œ / ê²¬ì  ìƒì„±(ë‹¨ê°€ ê°€ì •)
*/

/* ìœ í‹¸ */
const $ = sel => document.querySelector(sel);
const csvEscape = s => ('"' + String(s).replace(/"/g,'""') + '"');

/* ë°ì´í„° í–‰ ê´€ë¦¬ */
let rows = []; // {id, laundryType, pre, post}
const tbody = $('#dataRows');

function renderTable(){
  tbody.innerHTML = '';
  rows.forEach((r, idx) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${idx+1}</td>
      <td><input data-idx="${idx}" data-field="type" value="${r.laundryType}" style="width:140px;background:transparent;color:#fff;border:none"></td>
      <td><input data-idx="${idx}" data-field="pre" type="number" step="0.01" min="0" value="${r.pre}" style="width:80px;background:transparent;color:#fff;border:none"></td>
      <td><input data-idx="${idx}" data-field="post" type="number" step="0.01" min="0" value="${r.post}" style="width:80px;background:transparent;color:#fff;border:none"></td>
      <td style="width:60px"><button data-del="${idx}" class="btn secondary" style="padding:6px 8px">ì‚­ì œ</button></td>`;
    tbody.appendChild(tr);
  });
  attachRowListeners();
  updateChart();
}

function attachRowListeners(){
  tbody.querySelectorAll('input').forEach(inp=>{
    inp.addEventListener('input', (e)=>{
      const idx = Number(e.target.dataset.idx);
      const f = e.target.dataset.field;
      if(!rows[idx]) return;
      rows[idx][f === 'type' ? 'laundryType' : f] = f === 'type' ? e.target.value : Number(e.target.value);
      updateChart();
    });
  });
  tbody.querySelectorAll('button[data-del]').forEach(btn=>{
    btn.addEventListener('click', (e)=>{
      const i = Number(e.target.dataset.del);
      rows.splice(i,1);
      renderTable();
    });
  });
}

/* add row */
$('#addRow').addEventListener('click', ()=>{
  rows.push({laundryType:'í•©ì„±ì„¬ìœ ', pre:0.00, post:0.00});
  renderTable();
});

/* CSV export */
$('#exportCSV').addEventListener('click', ()=>{
  const team = $('#teamName').value || 'team';
  const header = ['íŒ€ëª…', team, '', ''];
  let csv = 'ì‹¤í—˜ë²ˆí˜¸,ì„¸íƒë¬¼,í•„í„° ì „(g),í•„í„° í›„(g),í¬ì§‘(g)\n';
  rows.forEach((r,i) => {
    const collected = (Number(r.post) - Number(r.pre)) || 0;
    csv += [i+1, r.laundryType, r.pre, r.post, collected].map(csvEscape).join(',') + '\n';
  });
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = team.replace(/\s+/g,'_') + '_plafilter.csv';
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});

/* calculator */
$('#calcBtn').addEventListener('click', ()=>{
  const perWash = Math.max(0, Number($('#perWash').value) || 0);
  const eff = Math.min(100, Math.max(0, Number($('#eff').value) || 0));
  const washes = Math.max(0, Number($('#washes').value) || 0);
  const monthlyCaptured = perWash * (eff/100) * washes;
  $('#calcResult').textContent = `ì˜ˆìƒ ì›” í¬ì§‘ëŸ‰: ${monthlyCaptured.toFixed(2)} g (í•„í„° íš¨ìœ¨ ${eff}% ê¸°ì¤€)`;
});
$('#resetCalc').addEventListener('click', ()=>{
  $('#perWash').value = 0.5; $('#eff').value = 85; $('#washes').value = 30;
  $('#calcResult').textContent = '';
});

/* demo data load & clear */
$('#loadDemo').addEventListener('click', ()=>{
  rows = [
    {laundryType:'í•©ì„± 3kg', pre:0.00, post:0.85},
    {laundryType:'ë©´ 3kg', pre:0.00, post:0.12},
    {laundryType:'í•©ì„± 3kg(ë°˜ë³µ)', pre:0.00, post:0.78},
  ];
  renderTable();
});
$('#clearData').addEventListener('click', ()=>{ rows = []; renderTable(); });

/* chart: ê°„ë‹¨í•œ ë°” ì°¨íŠ¸ (ìº”ë²„ìŠ¤) */
const chart = document.getElementById('chart');
const ctx = chart.getContext && chart.getContext('2d');
function sizeCanvas(){
  chart.width = chart.clientWidth * devicePixelRatio;
  chart.height = chart.clientHeight * devicePixelRatio;
  if(ctx) ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
}
window.addEventListener('resize', ()=>{ sizeCanvas(); updateChart(); });
sizeCanvas();

function updateChart(){
  if(!ctx) return;
  // clear
  ctx.clearRect(0,0,chart.width,chart.height);
  // data
  const data = rows.map(r => Math.max(0, (Number(r.post) - Number(r.pre)) || 0));
  const labels = rows.map((r, i) => `#${i+1}`);
  const w = chart.clientWidth, h = chart.clientHeight;
  sizeCanvas();
  // draw axes
  ctx.fillStyle = 'rgba(255,255,255,0.08)';
  ctx.fillRect(0,0,w,h);
  ctx.fillStyle = '#d9f7f0';
  ctx.font = '12px sans-serif';
  const max = Math.max(0.1, Math.max(...data, 0.1));
  const barW = Math.max(12, (w - 40) / Math.max(1, data.length) - 10);
  data.forEach((val, i) => {
    const x = 20 + i*(barW + 10);
    const barH = (val / max) * (h - 40);
    // gradient
    const g = ctx.createLinearGradient(x, h-20, x, h-20-barH);
    g.addColorStop(0, '#ff6b6b'); g.addColorStop(1,'#ffd700');
    ctx.fillStyle = g;
    ctx.fillRect(x, h-20-barH, barW, barH);
    ctx.fillStyle = '#001';
    ctx.fillText((val).toFixed(2)+'g', x, h-24-barH < 8 ? h-24-barH - 2 : h-24-barH);
    ctx.fillStyle = '#e8fdf6';
    ctx.fillText(labels[i], x, h-2);
  });
}

/* SVG í…œí”Œë¦¿ (ê°„ë‹¨í•œ ë©”ì‰¬ íŒ¨í„´ + ì¹˜ìˆ˜) ë‹¤ìš´ë¡œë“œ ë° ì¸ì‡„ */
const svgTemplate = `<?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="210mm" height="297mm" viewBox="0 0 210 297">
  <style>
    .title{font: bold 6px sans-serif; fill:#003;}
    .mesh{stroke:#000; stroke-width:0.02}
  </style>
  <rect x="10" y="20" width="190" height="110" fill="none" stroke="#003" stroke-width="0.2"/>
  <text x="12" y="18" class="title">í”Œë¼í•„í„° - ë©”ì‰¬ ì‹œíŠ¸ (ë‹¨ìœ„: mm)</text>
  <!-- simple mesh pattern (for printing to cut as stencil) -->
  <g stroke="#000" stroke-width="0.05" opacity="0.6">
    <!-- vertical -->
    ${Array.from({length:19}).map((_,i)=>`<line x1="${15 + i*9.5}" y1="25" x2="${15 + i*9.5}" y2="120" class="mesh"/>`).join('')}
    <!-- horizontal -->
    ${Array.from({length:10}).map((_,i)=>`<line x1="15" y1="${25 + i*10}" x2="200" y2="${25 + i*10}" class="mesh"/>`).join('')}
  </g>
  <text x="12" y="135" class="title">ì„¤ëª…: ì´ í…œí”Œë¦¿ì€ ê°„ë‹¨í•œ ë©”ì‰¬ íŒ¨í„´ ì¸ì‡„ìš©ì…ë‹ˆë‹¤. ì‹¤ì œ ì œì‘ ì‹œ ì¬ë£Œ(ìŠ¤í…Œì¸ë¦¬ìŠ¤ ë©”ì‰¬ ë“±) ì„ íƒ ê¶Œì¥.</text>
</svg>`;

$('#downloadSVG').addEventListener('click', ()=>{
  const blob = new Blob([svgTemplate], {type:'image/svg+xml'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'plafilter_template.svg';
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});
$('#printSVG').addEventListener('click', ()=>{
  const w = window.open('', '_blank');
  if(!w) return alert('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. íŒì—… í—ˆìš© í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.');
  w.document.write(svgTemplate);
  w.document.close();
  w.focus();
  w.print();
});

/* ê²¬ì  ìƒì„±: ê°„ë‹¨ ì‹œì—° (ë‹¨ê°€ ê°€ì •) */
$('#generateQuote').addEventListener('click', ()=>{
  const qty = Math.max(1, Number($('#orderQty').value) || 1);
  const unitCost = 2.5; // ê°€ì •: ì¬ë£Œ+í¬ì¥ ë‹¨ê°€(ì› ë‹¨ìœ„ ì•„ë‹˜, ì‹œì—°ìš©)
  const setup = 15;
  const total = (unitCost * qty) + setup;
  $('#quote').textContent = `ê²¬ì : ìˆ˜ëŸ‰ ${qty}ê°œ, ë‹¨ê°€ ${unitCost.toFixed(2)}ì›, ì„¤ì¹˜ë¹„ ${setup}ì› â†’ ì´ ${total.toFixed(2)}ì› (ì‹œì—°ê°’)`;
});

/* ë„ì›€ë§ ë²„íŠ¼ */
$('#help').addEventListener('click', ()=>{
  alert('í”Œë¼í•„í„° ì±Œë¦°ì§€ ë°ëª¨\n\n- ì‹¤í—˜ í…Œì´ë¸”ì— ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì„¸ìš”.\n- ê³„ì‚°ê¸°ë¡œ ì›” í¬ì§‘ëŸ‰ì„ ì˜ˆìƒí•˜ê³ , CSVë¡œ ë‚´ë³´ë‚´ ë°œí‘œ ìë£Œë¡œ ì‚¬ìš©í•˜ì„¸ìš”.\n- í…œí”Œë¦¿ì„ ë‚´ë ¤ë°›ì•„ ì‹¤ì œë¡œ ì œì‘í•´ ì‹¤í—˜í•´ë³´ì„¸ìš”.\n\n(ì´ ì•±ì€ ë¡œì»¬ ë°ëª¨ìš©ì…ë‹ˆë‹¤. ì„œë²„ ì—°ë™ ì—†ì´ ì‘ë™í•©ë‹ˆë‹¤.)');
});

/* ì´ˆê¸°í™”: ë¹ˆ í–‰ í•œ ê°œ ì¶”ê°€ */
rows = [{laundryType:'í•©ì„±ì„¬ìœ ', pre:0.00, post:0.00}];
renderTable();
updateChart();

/* snow visual control */
$('#snowRange').addEventListener('input', (e)=>{
  const v = Number(e.target.value);
  document.querySelectorAll('.snow').forEach((s, i)=>{
    s.style.opacity = (0.1 + v/120).toString();
    s.style.animationDuration = (7 - v/30 + i*1.5) + 's';
  });
});
</script>
</body>
</html>
